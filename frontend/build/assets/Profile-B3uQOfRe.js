import{A as U,u as x,c as E,b as P,r as m,h as S,g as k,D as L,j as a,E as I,k as h,H as v,l as C,s as D}from"./index-r-D1rjOl.js";import"/api/js-modules/client-environment";async function w(t,e={}){var o;if(e.method==="PUT"&&!((o=e.body)!=null&&o.fileName))throw new Error("Expected `fileName` when uploading attachment");const s=new URL("/api/files",window.origin);s.searchParams.set("file",t);const r=await U.fetch(s,e),{signedURL:i,...c}=r;return{signedUrl:i,...c}}async function F(t,e){try{const{signedUrl:s}=await w(t,{method:"DELETE"});return await fetch(s,{method:"DELETE"}),null}catch(s){return e("deleteFile",s,""),t}}async function T(t,e){try{const{signedUrl:s,filePath:r}=await w(t.name,{method:"PUT",body:{fileName:t.name}});return await fetch(s,{method:"PUT",body:t}),{...t,value:r,signedUrl:s}}catch(s){return e("uploadFile",s,""),null}}function A(){const t=x(E),e=x(P),[s,r]=m.useState({name:"",email:"",password:"",avatarUrl:""}),[i,c]=m.useState(!1),[o,u]=m.useState(""),g=S("UserProfile"),d=k();m.useEffect(()=>{e&&r({name:e.name,email:e.email,password:"",avatarUrl:e.profileImgLink||L})},[e]);const p=n=>r({...s,[n.target.name]:n.target.value}),b=async n=>{n.preventDefault(),c(!0),u("");try{const l={name:s.name,email:s.email};s.password&&(l.password=s.password),s.avatarUrl&&(l.avatarUrl=s.avatarUrl),await d(v({userId:e._id,updates:l})).unwrap(),u("✅ Profile updated successfully.")}catch{u("❌ Error updating profile.")}finally{c(!1)}},j=async n=>{var f;const l=(f=n.target.files)==null?void 0:f[0];if(l){d(h("Updating profile picture..."));const{signedUrl:y}=await T(l,g),N=y.split("?")[0];e.profileImgLink&&await F(e.profileImgLink,g),await d(v({userId:e._id,updates:{profileImgLink:N}})).unwrap(),d(C("Profile picture uploaded successfully.")),d(h(!1))}};return a.jsx("div",{className:`${t?"ml-63 w-[80vw]":"ml-20 w-[80vw]"} overflow-x-hidden transition-all duration-500 p-6 min-h-screen bg-gray-50`,children:a.jsxs("div",{className:"max-w-3xl mx-auto bg-white rounded-3xl shadow-xl p-10 space-y-8",children:[a.jsxs("div",{className:"flex flex-col items-center gap-3",children:[a.jsxs("div",{className:"relative group w-24 h-24",children:[a.jsx("img",{src:s.avatarUrl||"/default-avatar.png",alt:"User avatar",className:"h-24 w-24 rounded-full border-4 border-green-200 shadow-md object-cover"}),a.jsx("label",{htmlFor:"avatar-upload",className:"absolute inset-0 flex items-center justify-center rounded-full bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-300 cursor-pointer",children:a.jsx(I,{className:"text-white text-2xl"})}),a.jsx("input",{id:"avatar-upload",type:"file",accept:"image/*",onChange:j,className:"hidden"})]}),a.jsx("h1",{className:"text-3xl font-bold text-green-800",children:"Your Profile"}),o&&a.jsx("p",{className:"text-sm text-center text-green-600",children:o})]}),a.jsxs("form",{onSubmit:b,className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-green-800 font-medium",children:"Name"}),a.jsx("input",{name:"name",type:"text",value:s.name,onChange:p,className:"w-full mt-1 p-3 border border-green-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-400 transition"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-green-800 font-medium",children:"Email"}),a.jsx("input",{disabled:!0,name:"email",type:"email",value:s.email,onChange:p,className:"w-full mt-1 p-3 bg-gray-100 border border-gray-300 rounded-xl focus:outline-none"})]}),a.jsx("button",{type:"submit",disabled:i,className:`w-full py-3 rounded-xl text-white font-bold shadow-md transition ${i?"bg-green-400 opacity-50 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,children:i?"Updating...":"Update Profile"})]}),a.jsx("hr",{className:"my-6"}),a.jsxs("div",{className:"grid grid-cols-2 gap-y-4 gap-x-2 text-green-800 text-sm",children:[a.jsx("div",{className:"font-semibold",children:"Role:"}),a.jsx("div",{className:"text-green-700",children:e==null?void 0:e.role}),a.jsx("div",{className:"font-semibold",children:"Eco Points:"}),a.jsx("div",{className:"text-green-700",children:e==null?void 0:e.ecoPoints}),a.jsx("div",{className:"font-semibold",children:"Level:"}),a.jsx("div",{className:"text-green-700",children:e==null?void 0:e.level}),a.jsx("div",{className:"font-semibold",children:"Current Streak:"}),a.jsx("div",{className:"text-green-700",children:e==null?void 0:e.currentStreak}),a.jsx("div",{className:"font-semibold",children:"Longest Streak:"}),a.jsx("div",{className:"text-green-700",children:e==null?void 0:e.longestStreak})]})]})})}D(A,"UserProfile");export{A as default};
