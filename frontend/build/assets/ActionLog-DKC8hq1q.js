import{r as o,M as _,j as e,x as R,P as H,y as T,z as q,B as z,q as F,a as O,m as $,C as U,u as k,b as W,c as B,g as G,h as K,A as v,k as D,s as J}from"./index-r-D1rjOl.js";import"/api/js-modules/client-environment";class Q extends o.Component{getSnapshotBeforeUpdate(d){const n=this.props.childRef.current;if(n&&d.isPresent&&!this.props.isPresent){const i=n.offsetParent,a=i instanceof HTMLElement&&i.offsetWidth||0,s=this.props.sizeRef.current;s.height=n.offsetHeight||0,s.width=n.offsetWidth||0,s.top=n.offsetTop,s.left=n.offsetLeft,s.right=a-s.width-s.left}return null}componentDidUpdate(){}render(){return this.props.children}}function V({children:r,isPresent:d,anchorX:n}){const i=o.useId(),a=o.useRef(null),s=o.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:t}=o.useContext(_);return o.useInsertionEffect(()=>{const{width:c,height:l,top:b,left:u,right:p}=s.current;if(d||!a.current||!c||!l)return;const x=n==="left"?`left: ${u}`:`right: ${p}`;a.current.dataset.motionPopId=i;const f=document.createElement("style");return t&&(f.nonce=t),document.head.appendChild(f),f.sheet&&f.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${c}px !important;
            height: ${l}px !important;
            ${x}px !important;
            top: ${b}px !important;
          }
        `),()=>{document.head.contains(f)&&document.head.removeChild(f)}},[d]),e.jsx(Q,{isPresent:d,childRef:a,sizeRef:s,children:o.cloneElement(r,{ref:a})})}const X=({children:r,initial:d,isPresent:n,onExitComplete:i,custom:a,presenceAffectsLayout:s,mode:t,anchorX:c})=>{const l=R(Y),b=o.useId();let u=!0,p=o.useMemo(()=>(u=!1,{id:b,initial:d,isPresent:n,custom:a,onExitComplete:x=>{l.set(x,!0);for(const f of l.values())if(!f)return;i&&i()},register:x=>(l.set(x,!1),()=>l.delete(x))}),[n,l,i]);return s&&u&&(p={...p}),o.useMemo(()=>{l.forEach((x,f)=>l.set(f,!1))},[n]),o.useEffect(()=>{!n&&!l.size&&i&&i()},[n]),t==="popLayout"&&(r=e.jsx(V,{isPresent:n,anchorX:c,children:r})),e.jsx(H.Provider,{value:p,children:r})};function Y(){return new Map}const N=r=>r.key||"";function M(r){const d=[];return o.Children.forEach(r,n=>{o.isValidElement(n)&&d.push(n)}),d}const Z=({children:r,custom:d,initial:n=!0,onExitComplete:i,presenceAffectsLayout:a=!0,mode:s="sync",propagate:t=!1,anchorX:c="left"})=>{const[l,b]=T(t),u=o.useMemo(()=>M(r),[r]),p=t&&!l?[]:u.map(N),x=o.useRef(!0),f=o.useRef(u),C=R(()=>new Map),[g,h]=o.useState(u),[y,A]=o.useState(u);q(()=>{x.current=!1,f.current=u;for(let j=0;j<y.length;j++){const m=N(y[j]);p.includes(m)?C.delete(m):C.get(m)!==!0&&C.set(m,!1)}},[y,p.length,p.join("-")]);const S=[];if(u!==g){let j=[...u];for(let m=0;m<y.length;m++){const w=y[m],E=N(w);p.includes(E)||(j.splice(m,0,w),S.push(w))}return s==="wait"&&S.length&&(j=S),A(M(j)),h(u),null}const{forceRender:L}=o.useContext(z);return e.jsx(e.Fragment,{children:y.map(j=>{const m=N(j),w=t&&!l?!1:u===y||p.includes(m),E=()=>{if(C.has(m))C.set(m,!0);else return;let P=!0;C.forEach(I=>{I||(P=!1)}),P&&(L==null||L(),A(f.current),t&&(b==null||b()),i&&i())};return e.jsx(X,{isPresent:w,initial:!x.current||n?void 0:!1,custom:d,presenceAffectsLayout:a,mode:s,onExitComplete:w?void 0:E,anchorX:c,children:j},m)})})};function ee({onSubmit:r,defaultValues:d,habits:n}){const[i,a]=o.useState(d||{habitId:"",quantity:1,date:new Date().toISOString().split("T")[0],note:""}),s=t=>a({...i,[t.target.name]:t.target.value});return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-lg mx-auto",children:[e.jsxs("h2",{className:"text-2xl font-bold text-green-700 flex items-center space-x-2 mb-4",children:[e.jsx(F,{className:"text-green-500"})," Log Your Action"]}),e.jsxs("form",{onSubmit:t=>{t.preventDefault(),r(i),a({habitId:"",quantity:1,date:new Date().toISOString().split("T")[0],note:""})},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-green-700 font-semibold mb-1",children:"Habit"}),e.jsxs("select",{name:"habitId",value:i.habitId,onChange:s,className:"w-full p-2 border border-green-300 rounded focus:outline-none focus:border-green-600 transition-colors",children:[e.jsx("option",{value:"",children:"Select"}),n==null?void 0:n.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-green-700 font-semibold mb-1",children:"Quantity"}),e.jsx("input",{type:"number",name:"quantity",value:i.quantity,onChange:s,min:"1",className:"w-full p-2 border border-green-300 rounded focus:outline-none focus:border-green-600 transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-green-700 font-semibold mb-1",children:"Date"}),e.jsx("input",{type:"date",name:"date",value:i.date,onChange:s,className:"w-full p-2 border border-green-300 rounded focus:outline-none focus:border-green-600 transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-green-700 font-semibold mb-1",children:"Notes (optional)"}),e.jsx("textarea",{name:"note",value:i.note,onChange:s,className:"w-full p-2 border border-green-300 rounded focus:outline-none focus:border-green-600 transition-colors",rows:"3",placeholder:"Add any additional details about your action..."})]}),e.jsxs("button",{type:"submit",className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors flex items-center justify-center w-full",children:[e.jsx(O,{className:"mr-2"})," Save Action"]})]})]})}function te({logs:r,onDelete:d,onUpdate:n}){const[i,a]=o.useState({}),s=t=>{a(c=>({...c,[t]:!c[t]}))};return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-2xl font-bold text-green-700 mb-4",children:"Recent Actions"}),e.jsx("ul",{className:"divide-y mt-3",children:e.jsx(Z,{children:r.map(t=>{var l;const c=i[t._id];return e.jsxs($.li,{className:"flex justify-between items-center py-3",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},children:[e.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[t.isCompleted?e.jsx(U,{className:"text-green-500"}):e.jsx("input",{type:"checkbox",checked:c||!1,onChange:()=>s(t._id),className:"w-5 h-5 text-green-600"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{children:[(l=t.habit)==null?void 0:l.name," - ",t.quantity," unit",t.quantity>1?"s":""]}),e.jsxs("span",{className:"text-sm text-green-600 mt-1",children:["Points Earned: ",t.points," | COâ‚‚ Saved: ",t.co2Saved," kg"]})]})]}),!t.isCompleted&&c&&e.jsx("button",{onClick:()=>n(t._id),className:"bg-green-600 text-white px-2 py-1 rounded hover:bg-green-700 transition",children:"Mark as Completed"})]},t._id)})})})]})}function ne(){const[r,d]=o.useState([]),[n,i]=o.useState([]),[a,s]=o.useState([]),t=k(W),c=t._id,l=k(B),b=G(),u=K("ActionLogManager");o.useEffect(()=>{c&&(async()=>{const h=await v.fetch(`/api/user-log/user/${c}`);s(h)})()},[c]);async function p(){const[g,h]=await Promise.all([v.fetch("/api/habit/global"),v.fetch(`/api/habit/custom/${t==null?void 0:t._id}`)]);d(g),i(h)}o.useEffect(()=>{p()},[]);const x=async g=>{b(D("Adding Action..."));try{const h=await v.fetch(`/api/log/${c}`,{method:"POST",body:JSON.stringify(g)});s([...a,h])}catch(h){u("handleLogSubmit",h,"Failed to add new log")}finally{b(D(!1))}},f=async g=>{confirm("Delete this habit?")&&(await v.fetch(`/api/log/${c}/${g}`,{method:"DELETE"}),s(a.filter(h=>h._id!==g)))};async function C(g){const h=await v.fetch(`/api/update/log/${g}`,{method:"PATCH"});s(a.map(y=>y._id===h._id?h:y))}return e.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:`${l?"ml-63 w-[78vw]":"ml-20 w-[80vw]"} overflow-x-hidden transition-all duration-500 p-6 min-h-screen`,children:[e.jsx(ee,{onSubmit:x,habits:[...r,...n]}),e.jsx("div",{className:"mt-8",children:e.jsx(te,{logs:a,onDelete:f,onUpdate:C})})]})}J(ne,"ActionLogManager");export{ne as default};
